generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Updated Influencer model - matches your migrated database
model Influencer {
  id                String   @id @default(cuid())
  
  // Basic Info
  username          String   @unique
  fullName          String?  @map("full_name")
  email             String?
  // üóëÔ∏è REMOVED: gender and locationCity (migrated out)
  
  // Social Media Handles
  instagramHandle   String?  @map("instagram_handle")
  youtubeChannel    String?  @map("youtube_channel")
  tiktokHandle      String?  @map("tiktok_handle")
  
  // Follower Counts
  instagramFollowers Int     @default(0) @map("instagram_followers")
  youtubeSubscribers Int     @default(0) @map("youtube_subscribers")
  tiktokFollowers    Int     @default(0) @map("tiktok_followers")
  totalFollowers     Int     @default(0) @map("total_followers")
  
  // üÜï NEW YOUTUBE METRICS (added by migration)
  videoCount        Int?     @default(0) @map("video_count")
  totalViews        BigInt?  @default(0) @map("total_views")
  youtubeUrl        String?  @map("youtube_url")
  
  // Engagement & Category
  engagementRate    Decimal? @map("engagement_rate") @db.Decimal(5,2)
  category          String?
  
  // Profile Info
  bio               String?  @db.Text
  profileImageUrl   String?  @map("profile_image_url")
  verified          Boolean  @default(false)
  
  // Vector Search Support
  embeddingVector   Json?    @map("embedding_vector")
  contentHash       String?  @map("content_hash")
  
  // Timestamps
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  lastUpdated       DateTime? @map("last_updated") // üÜï From data source
  
  @@index([username])
  @@index([category])
  @@index([totalFollowers])
  @@index([engagementRate])
  @@index([instagramHandle])
  @@index([youtubeChannel])
  @@index([tiktokHandle])
  @@index([contentHash])
  @@index([videoCount])       // üÜï New index
  @@index([totalViews])       // üÜï New index
  @@map("influencers")
}

// Simplified Platform model
model Platform {
  id          Int    @id @default(autoincrement())
  name        String @unique
  displayName String @map("display_name")

  @@map("platforms")
}

// Simplified User model (if needed for future)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

// Simplified Search Logs for analytics
model SearchLog {
  id             Int      @id @default(autoincrement())
  query          String
  userEmail      String?  @map("user_email")
  resultsCount   Int      @default(0) @map("results_count")
  filtersApplied Json?    @map("filters_applied")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([createdAt])
  @@map("search_logs")
}

// API Keys for authentication
model ApiKey {
  id               Int      @id @default(autoincrement())
  keyHash          String   @unique @map("key_hash")
  name             String
  email            String?
  planType         String?  @default("free") @map("plan_type")
  requestsPerDay   Int      @default(100) @map("requests_per_day")
  requestsUsedToday Int     @default(0) @map("requests_used_today")
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  lastUsed         DateTime? @map("last_used")

  @@index([keyHash])
  @@map("api_keys")
}